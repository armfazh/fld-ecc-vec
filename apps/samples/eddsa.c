#include<faz_eddsa_avx2.h>
#include<faz_fp_avx2.h>
#include<stdio.h>
#include<string.h>
#include "../tests/vectors.h"

int main(void)
{
    size_t size_key = ED25519_KEY_SIZE_BYTES_PARAM;
    size_t size_sig = ED25519_SIG_SIZE_BYTES_PARAM;
    Ed25519_PublicKey pub_key;
    Ed25519_PrivateKey pri_key;
    Ed25519_Signature signature;
    int response = 0;
    

    uint8_t * message = (uint8_t *)"Keep Calm and Carry On";
    const size_t size_msg = strlen((const char *)message);

    printf("=== Ed25519 Example ===\n");

    /* Key generation */
//    random_bytes(pri_key,size_key);

    EdDSA_TestData v = {
        .private_key = {
            0xb3,0xa5,0xef,0x2b,0xcb,0xed,0x81,0x9d,0x6c,0x53,0x53,0xf7,0x90,0x67,0x2c,0xf4,
            0x6e,0x34,0xc0,0x79,0x90,0x8a,0x11,0x92,0xbc,0xa5,0xbf,0x73,0xa7,0x78,0x6f,0xf1
        },
        .public_key ={
            0x4a,0xf4,0xa9,0xc6,0xb1,0x98,0xbd,0xd0,0xdc,0x75,0xa7,0x08,0xe5,0xc8,0x7a,0xd0,
            0x02,0xbc,0x4a,0x52,0x72,0xec,0x43,0xb7,0x18,0x7a,0x00,0x2e,0xe2,0x3c,0x88,0xdd
        },
        .message = {
            0xb3,0xdb,0x42,0xb0,0x4d
        },
        .message_length = 5,
        .signature = {
            0x11,0x37,0x87,0x7e,0xd8,0x63,0xfe,0xa6,0x68,0x92,0xfb,0x6f,0x1f,0x3c,0xf0,0xad,
            0x60,0x88,0x9c,0xc3,0x1f,0x07,0xd8,0x89,0x77,0x2b,0x20,0x77,0x1a,0x1e,0x82,0x59,
            0x07,0x4e,0xda,0x98,0x1f,0xa4,0x6c,0x0f,0x0e,0xa0,0x39,0x8a,0xf3,0x75,0xf8,0x41,
            0x8d,0x5b,0x9c,0x80,0x22,0xfb,0x17,0x99,0x95,0xfa,0x82,0x0f,0xfe,0x8c,0x31,0x0e
        },
    };

    EdDSA.Ed25519.keygen(pub_key,v.private_key);
    printf("Alice's Private Key:\n"); print_bytes(v.private_key,size_key);
    printf("Alice's Public Key:\n");  print_bytes(pub_key,size_key); print_bytes(v.public_key,size_key);

    printf("Message in ascii: \n%s\n",message);
    printf("Message in hex: \n"); print_bytes(v.message,v.message_length);

    /* Signature generation */
    EdDSA.Ed25519.sign(signature,v.message,v.message_length,pub_key,v.private_key);
    printf("Ed25519 Signature:\n");  print_bytes(signature,size_sig);print_bytes(v.signature,size_sig);

    /* Signature verification */
    response = EdDSA.Ed25519.verify(v.message,v.message_length,pub_key,signature);
    if( response == EDDSA_VERIFICATION_OK )
        printf("Valid signature.\n");
    else
        printf("Signature invalid.\n");

    return 0;
}


